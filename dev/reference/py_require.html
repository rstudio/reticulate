<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Declare Python Requirements — py_require • reticulate</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Declare Python Requirements — py_require"><meta name="description" content="py_require() allows you to declare Python requirements for the R session,
including Python packages, any version constraints on those packages, and any
version constraints on Python itself. Reticulate can then automatically
create and use an ephemeral Python environment that satisfies all these
requirements."><meta property="og:description" content="py_require() allows you to declare Python requirements for the R session,
including Python packages, any version constraints on those packages, and any
version constraints on Python itself. Reticulate can then automatically
create and use an ephemeral Python environment that satisfies all these
requirements."><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">reticulate</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.44.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/arrays.html">Arrays in R and Python</a></li>
    <li><a class="dropdown-item" href="../articles/calling_python.html">Calling Python from R</a></li>
    <li><a class="dropdown-item" href="../articles/package.html">Using reticulate in an R Package</a></li>
    <li><a class="dropdown-item" href="../articles/python_dependencies.html">Managing an R Package's Python Dependencies</a></li>
    <li><a class="dropdown-item" href="../articles/python_packages.html">Installing Python Packages</a></li>
    <li><a class="dropdown-item" href="../articles/python_primer.html">Primer on Python for R Users</a></li>
    <li><a class="dropdown-item" href="../articles/r_markdown.html">R Markdown Python Engine</a></li>
    <li><a class="dropdown-item" href="../articles/rstudio_ide.html">RStudio IDE Tools for reticulate</a></li>
    <li><a class="dropdown-item" href="../articles/versions.html">Python Version Configuration</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/reticulate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Declare Python Requirements</h1>
      <small class="dont-index">Source: <a href="https://github.com/rstudio/reticulate/blob/main/R/py_require.R" class="external-link"><code>R/py_require.R</code></a></small>
      <div class="d-none name"><code>py_require.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>py_require()</code> allows you to declare Python requirements for the R session,
including Python packages, any version constraints on those packages, and any
version constraints on Python itself. Reticulate can then automatically
create and use an ephemeral Python environment that satisfies all these
requirements.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">py_require</span><span class="op">(</span></span>
<span>  packages <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  python_version <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  exclude_newer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"add"</span>, <span class="st">"remove"</span>, <span class="st">"set"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-packages">packages<a class="anchor" aria-label="anchor" href="#arg-packages"></a></dt>
<dd><p>A character vector of Python packages to be available during
the session. These can be simple package names like <code>"jax"</code> or names with
version constraints like <code>"jax[cpu]&gt;=0.5"</code>. Pip style syntax for installing
from local files or a git repository is also supported (see details).</p></dd>


<dt id="arg-python-version">python_version<a class="anchor" aria-label="anchor" href="#arg-python-version"></a></dt>
<dd><p>A character vector of Python version constraints <br>
(e.g., <code>"3.10"</code> or <code>"&gt;=3.9,&lt;3.13"</code>).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Reserved for future extensions; must be empty.</p></dd>


<dt id="arg-exclude-newer">exclude_newer<a class="anchor" aria-label="anchor" href="#arg-exclude-newer"></a></dt>
<dd><p>Limit package versions to those published before a
specified date. This offers a lightweight alternative to freezing package
versions, helping guard against Python package updates that break a
workflow. Accepts strings formatted as RFC 3339 timestamps (e.g.,
<code>"2006-12-02T02:07:43Z"</code>) and local dates in the same format (e.g.,
<code>"2006-12-02"</code>) in your system's configured time zone. Once <code>exclude_newer</code>
is set, only the <code>set</code> action can override it.</p></dd>


<dt id="arg-action">action<a class="anchor" aria-label="anchor" href="#arg-action"></a></dt>
<dd><p>Determines how <code>py_require()</code> processes the provided
requirements. Options are:</p><ul><li><p><code>"add"</code> (the default): Adds the entries to the current set of requirements.</p></li>
<li><p><code>"remove"</code>: Removes <em>exact</em> matches from the requirements list.
Requests to remove nonexistent entries are ignored. For example, if
<code>"numpy==2.2.2"</code> is in the list, passing <code>"numpy"</code> with <code>action="remove"</code>
will not remove it.</p></li>
<li><p><code>"set"</code>: Clears all existing requirements and replaces them with the
provided ones. Packages and the Python version can be set independently.</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>py_require()</code> is primarily called for its side effect of modifying
the manifest of "Python requirements" for the current R session  that
reticulate maintains internally. <code>py_require()</code> usually returns <code>NULL</code>
invisibly. If <code>py_require()</code> is called with no arguments, it returns the
current manifest–a list with names <code>packages</code>, <code>python_version</code>, and
<code>exclude_newer.</code> The list also has a class attribute, to provide a print
method.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Reticulate will only use an ephemeral environment if no other Python
installation is found earlier in the <a href="https://rstudio.github.io/reticulate/articles/versions.html#order-of-discovery">Order of Discovery</a>.
You can also force reticulate to use an ephemeral environment by setting
<code>Sys.setenv(RETICULATE_PYTHON="managed")</code>, or you can disable reticulate from
using an ephemeral environment by setting
<code>Sys.setenv(RETICULATE_USE_MANAGED_VENV="no")</code>.</p>
<p>The ephemeral virtual environment is not created until the user interacts
with Python for the first time in the R session, typically when <code><a href="import.html">import()</a></code> is
first called.</p>
<p>If <code>py_require()</code> is called with new requirements after reticulate has
already initialized an ephemeral Python environment, a new ephemeral
environment is activated on top of the existing one. Once Python is
initialized, only adding packages is supported—removing packages, changing
the Python version, or modifying <code>exclude_newer</code> is not possible.</p>
<p>Calling <code>py_require()</code> without arguments returns a list of the currently
declared requirements.</p>
<p>R packages can also call <code>py_require()</code> (e.g., in <code>.onLoad()</code> or elsewhere)
to declare Python dependencies. The print method for <code>py_require()</code> displays
the Python dependencies declared by R packages in the current session.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Reticulate uses <a href="https://docs.astral.sh/uv/" class="external-link"><code>uv</code></a> to resolve Python
dependencies. Many <code>uv</code> options can be customized via environment variables,
as described <a href="https://docs.astral.sh/uv/configuration/environment/" class="external-link">here</a>.
For example:</p><ul><li><p>If temporarily offline, to resolve packages from cache without checking for updates, set: <br><code>Sys.setenv(UV_OFFLINE = "1")</code>.</p></li>
<li><p>To use an additional package index: <br><code>Sys.setenv(UV_INDEX = "https://download.pytorch.org/whl/cpu")</code>. <br> (To add
multiple additional indexes, <code>UV_INDEX</code> can be a list of space-separated
urls).</p></li>
<li><p>To change the default package index: <br><code>Sys.setenv(UV_DEFAULT_INDEX = "https://my.org/python-packages-index/")</code></p></li>
<li><p>To allow resolving a prerelease dependency: <br><code>Sys.setenv(UV_PRERELEASE = "allow")</code>.</p></li>
<li><p>To force <code>uv</code> to create ephemeral environments using the system python: <br><code>Sys.setenv(UV_PYTHON_PREFERENCE = "only-system")</code></p></li>
</ul><p>For more advanced customization needs, there’s also the option to configure
<code>uv</code> with a user-level or system-level <code>uv.toml</code> file.</p><div class="section">
<h3 id="installing-from-alternate-sources">Installing from alternate sources<a class="anchor" aria-label="anchor" href="#installing-from-alternate-sources"></a></h3>


<p>The <code>packages</code> argument also supports declaring a dependency from a Git
repository or a local file. Below are some examples of valid <code>packages</code>
strings:</p><ul><li><p>Install Ruff from a specific Git tag:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="st">"git+https://github.com/astral-sh/ruff@v0.2.0"</span></span></code></pre><p></p></div></li>
<li><p>Install Ruff from a specific Git commit:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="st">"git+https://github.com/astral-sh/ruff@1fadefa67b26508cc59cf38e6130bde2243c929d"</span></span></code></pre><p></p></div></li>
<li><p>Install Ruff from a specific Git branch:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="st">"git+https://github.com/astral-sh/ruff@main"</span></span></code></pre><p></p></div></li>
<li><p>Install MarkItDown from the <code>main</code> branch—find the package in the
subdirectory 'packages/markitdown':</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="st">"markitdown@git+https://github.com/microsoft/markitdown.git@main#subdirectory=packages/markitdown"</span></span></code></pre><p></p></div></li>
<li><p>Install MarkItDown from the local filesystem by providing an absolute path to
a directory containing a <code>pyproject.toml</code> or <code>setup.py</code> file:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="st">"markitdown@/Users/tomasz/github/microsoft/markitdown/packages/markitdown/"</span></span></code></pre><p></p></div></li>
</ul><p>See more examples
<a href="https://docs.astral.sh/uv/pip/packages/#installing-a-package" class="external-link">here</a> and
<a href="https://pip.pypa.io/en/stable/cli/pip_install/#examples" class="external-link">here</a>.</p>
</div>

<div class="section">
<h3 id="clearing-the-cache">Clearing the Cache<a class="anchor" aria-label="anchor" href="#clearing-the-cache"></a></h3>


<p>If <code>uv</code> is already installed on your machine, <code>reticulate</code> will use the
existing <code>uv</code> installation as-is, including its default <code>cache dir</code> location.
To clear the caches of a self-managed <code>uv</code> installation, send the following
system commands to <code>uv</code>:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>uv cache clean</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>rm <span class="sc">-</span>r <span class="st">"$(uv python dir)"</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>rm <span class="sc">-</span>r <span class="st">"$(uv tool dir)"</span></span></code></pre><p></p></div>
<p>If an existing installation of <code>uv</code> is not found, <code>reticulate</code> will
automatically download and store it, along with other downloaded artifacts
and ephemeral environments, in the <code>tools::R_user_dir("reticulate", "cache")</code>
directory. To clear this cache manually, delete the directory:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># delete uv, ephemeral virtual environments, and all downloaded artifacts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/userdir.html" class="external-link">R_user_dir</a></span><span class="op">(</span><span class="st">"reticulate"</span>, <span class="st">"cache"</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Reticulate also clears its managed cache automatically on an interval,
defaulting to every 120 days. Configure this interval in <code>.Rprofile</code> with:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>reticulate.max_cache_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/difftime.html" class="external-link">as.difftime</a></span><span class="op">(</span><span class="fl">30</span>, units <span class="op">=</span> <span class="st">"days"</span><span class="op">)</span><span class="op">)</span></span></code></pre><p></p></div>
</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tomasz Kalinowski, Kevin Ushey, JJ Allaire, RStudio, Yuan Tang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

